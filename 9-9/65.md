å¯ä»¥è¿™ä¹ˆç†è§£è¿™ä¸ªé—®é¢˜ğŸ‘‡

---

### 1ï¸âƒ£ å…ˆææ¸…æ¥šå‘½ä»¤æ€ä¹ˆå¯åŠ¨çš„

å¯åŠ¨ä¸€ä¸ª `jar` åŒ…é€šå¸¸æ˜¯è¿™æ ·çš„å‘½ä»¤ï¼š

```bash
java -jar myapp.jar --spring.profiles.active=prod >app.log 2>&1 &
```

è¿™ä¸ªå‘½ä»¤åœ¨ **æ‰§è¡Œæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹**ï¼Œè¿›ç¨‹çš„ç¨‹åºæ˜¯ `java`ï¼Œå‘½ä»¤è¡Œé‡ŒåŒ…å« `-jar myapp.jar`ã€‚

> ä¹Ÿå°±æ˜¯è¯´ï¼š**jar æ˜¯ç”± Java è¿›ç¨‹è¿è¡Œçš„**ï¼Œä¸å†å±äºè°ƒç”¨å®ƒçš„é‚£ä¸ª shellã€‚

---

### 2ï¸âƒ£ å¦‚ä½•æ‰¾å‡ºå®ƒæ˜¯ä»å“ªé‡Œå¯åŠ¨çš„

å¦‚æœä½ åªçœ‹åˆ°å‘½ä»¤æ–‡æœ¬ï¼Œä½†ä¸çŸ¥é“æ˜¯è°æ‰§è¡Œçš„ï¼Œå¯ä»¥ä»ä»¥ä¸‹è§’åº¦æ’æŸ¥ï¼š

| æ–¹æ³•                                | è¯´æ˜                                                                  |                               |
| --------------------------------- | ------------------------------------------------------------------- | ----------------------------- |
| \`ps -ef                          | grep java\`                                                         | æŸ¥æ‰¾æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ java è¿›ç¨‹ï¼Œç¡®è®¤ PID å’Œå‘½ä»¤è¡Œ |
| `pstree -ap <PID>`                | æŸ¥çœ‹è¯¥ PID çš„çˆ¶è¿›ç¨‹æ ‘ï¼Œèƒ½çœ‹åˆ°å®ƒæ˜¯è¢«å“ªä¸ªè¿›ç¨‹å¯åŠ¨çš„ï¼ˆå¸¸è§æ˜¯ `bash` / `sh` / `systemd` / `cron`ï¼‰ |                               |
| `cat /proc/<PID>/cmdline`         | æŸ¥çœ‹è¿›ç¨‹çš„å®Œæ•´å¯åŠ¨å‘½ä»¤                                                         |                               |
| `cat /proc/<PID>/status` æˆ– `stat` | çœ‹çˆ¶è¿›ç¨‹å·ï¼ˆPPidï¼‰                                                         |                               |
| `lsof -p <PID>`                   | çœ‹çœ‹æ‰“å¼€äº†å“ªäº›æ–‡ä»¶ï¼Œæœ‰åŠ©åˆ¤æ–­æ˜¯è°æ‹‰èµ·æ¥çš„ï¼ˆæ¯”å¦‚ systemd çš„ unit æ–‡ä»¶ï¼‰                          |                               |
| æŸ¥çœ‹æœåŠ¡é…ç½®                            | å¦‚æœæ˜¯å®ˆæŠ¤æ–¹å¼å¯åŠ¨ï¼Œå¯èƒ½æ˜¯ `systemd service`ã€`supervisord`ã€`crontab`ã€`nohup` ç­‰å·¥å…· |                               |

---

### 3ï¸âƒ£ æ€»ç»“æµç¨‹

1. å…ˆç¡®è®¤ jar å¯¹åº”çš„ Java è¿›ç¨‹ PIDï¼š

   ```bash
   ps -ef | grep 'myapp.jar'
   ```
2. æ‹¿åˆ° PID åçœ‹çˆ¶è¿›ç¨‹ï¼š

   ```bash
   pstree -ap <PID>
   ```
3. å¦‚æœçˆ¶è¿›ç¨‹æ˜¯ `systemd`ï¼Œè¯´æ˜æ˜¯ä½œä¸º systemd æœåŠ¡å¯åŠ¨ï¼›å¦‚æœæ˜¯ `bash`ï¼Œå¯èƒ½æ˜¯æ‰‹åŠ¨æ‰§è¡Œæˆ–é€šè¿‡è„šæœ¬æ‰§è¡Œï¼›å¦‚æœæ˜¯ `cron`ï¼Œå°±æ˜¯å®šæ—¶ä»»åŠ¡ã€‚

---

ğŸ’¡ **ç»“è®º**
`jar` æœ¬èº«ä¸ä¼šâ€œåŒ…å«â€åœ¨ shell é‡Œè¿è¡Œï¼Œå®ƒå§‹ç»ˆæ˜¯ç‹¬ç«‹çš„ Java è¿›ç¨‹ã€‚è¦å›ç­”â€œåœ¨å“ªä¸ªè¿›ç¨‹é‡Œå¯åŠ¨çš„â€ï¼Œå°±æ˜¯è¦æ‰¾ **è¯¥ Java è¿›ç¨‹çš„çˆ¶è¿›ç¨‹æ˜¯è°**ï¼Œç”¨ `ps` / `pstree` / `/proc/<PID>` ä¿¡æ¯å°±èƒ½çœ‹å‡ºæ¥ã€‚

---

è¦ä¸è¦æŠŠä½ æ‰‹å¤´é‚£æ®µå®Œæ•´çš„å‘½ä»¤è´´å‡ºæ¥ï¼Ÿè¿™æ ·æˆ‘å¯ä»¥æ›´å…·ä½“åœ°å¸®ä½ åˆ†æå®ƒå¯èƒ½æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼å¯åŠ¨çš„ã€‚


# ç¾å›¢äºŒé¢ã€ä¸‰é¢é¢è¯•é¢˜å…¨é¢è§£ç­”

## äºŒé¢é—®é¢˜è§£ç­”

### 2. è¾“å…¥ç½‘å€åˆ°é¡µé¢æ˜¾ç¤ºå…¨è¿‡ç¨‹

```mermaid
sequenceDiagram
    participant User
    participant Browser
    participant DNS as DNSæœåŠ¡å™¨
    participant Server
    participant CDN
    participant DB as æ•°æ®åº“

    User->>Browser: è¾“å…¥URL
    Browser->>Browser: è§£æURL
    Browser->>DNS: DNSæŸ¥è¯¢
    DNS-->>Browser: è¿”å›IPåœ°å€
    
    Browser->>Server: TCPä¸‰æ¬¡æ¡æ‰‹
    Browser->>Server: å‘é€HTTPè¯·æ±‚
    Server->>DB: æ•°æ®åº“æŸ¥è¯¢
    DB-->>Server: è¿”å›æ•°æ®
    Server->>Server: å¤„ç†ä¸šåŠ¡é€»è¾‘
    Server-->>Browser: HTTPå“åº”
    
    Browser->>Browser: è§£æHTML
    Browser->>Browser: æ„å»ºDOMæ ‘
    Browser->>Browser: æ„å»ºCSSOMæ ‘
    Browser->>Browser: æ„å»ºæ¸²æŸ“æ ‘
    Browser->>Browser: å¸ƒå±€(Layout)
    Browser->>Browser: ç»˜åˆ¶(Painting)
    
    Browser->>CDN: åŠ è½½é™æ€èµ„æº
    CDN-->>Browser: è¿”å›èµ„æº
    Browser-->>User: æ˜¾ç¤ºé¡µé¢
```

**è¯¦ç»†è¿‡ç¨‹**ï¼š
1. **DNSè§£æ**ï¼šå°†åŸŸåè§£æä¸ºIPåœ°å€
2. **TCPè¿æ¥**ï¼šä¸‰æ¬¡æ¡æ‰‹å»ºç«‹TCPè¿æ¥
3. **å‘é€HTTPè¯·æ±‚**ï¼šæµè§ˆå™¨å‘é€è¯·æ±‚æŠ¥æ–‡
4. **æœåŠ¡å™¨å¤„ç†**ï¼šæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”
5. **æµè§ˆå™¨æ¸²æŸ“**ï¼šè§£æHTMLã€CSSï¼Œæ„å»ºæ¸²æŸ“æ ‘
6. **åŠ è½½é™æ€èµ„æº**ï¼šåŠ è½½JSã€å›¾ç‰‡ç­‰èµ„æº
7. **é¡µé¢äº¤äº’**ï¼šæ‰§è¡ŒJavaScriptï¼Œå¤„ç†ç”¨æˆ·äº¤äº’

### 3. Cookie vs Session

| ç‰¹æ€§ | Cookie | Session |
|------|--------|---------|
| **å­˜å‚¨ä½ç½®** | å®¢æˆ·ç«¯æµè§ˆå™¨ | æœåŠ¡å™¨ç«¯ |
| **å®‰å…¨æ€§** | è¾ƒä½ï¼Œå¯è¢«ç¯¡æ”¹ | è¾ƒé«˜ï¼ŒæœåŠ¡å™¨æ§åˆ¶ |
| **å­˜å‚¨å®¹é‡** | è¾ƒå°(4KBå·¦å³) | è¾ƒå¤§(å–å†³äºæœåŠ¡å™¨) |
| **ç”Ÿå‘½å‘¨æœŸ** | å¯è®¾ç½®è¿‡æœŸæ—¶é—´ | é€šå¸¸éšä¼šè¯ç»“æŸ |
| **æ€§èƒ½å½±å“** | æ¯æ¬¡è¯·æ±‚è‡ªåŠ¨æºå¸¦ | éœ€è¦æœåŠ¡å™¨æŸ¥æ‰¾ |

**Javaä¸­çš„Sessionå®ç°**ï¼š
```java
@RestController
public class SessionController {
    
    // è®¾ç½®Session
    @PostMapping("/login")
    public String login(HttpServletRequest request, @RequestBody LoginRequest loginRequest) {
        HttpSession session = request.getSession();
        session.setAttribute("userId", loginRequest.getUserId());
        session.setAttribute("username", loginRequest.getUsername());
        session.setMaxInactiveInterval(30 * 60); // 30åˆ†é’Ÿè¿‡æœŸ
        return "Login successful";
    }
    
    // è·å–Session
    @GetMapping("/profile")
    public UserProfile getProfile(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session == null) {
            throw new UnauthorizedException("è¯·å…ˆç™»å½•");
        }
        
        String userId = (String) session.getAttribute("userId");
        String username = (String) session.getAttribute("username");
        
        return new UserProfile(userId, username);
    }
    
    // é”€æ¯Session
    @PostMapping("/logout")
    public String logout(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session != null) {
            session.invalidate();
        }
        return "Logout successful";
    }
}
```

### 4. finalå…³é”®å­—ä½œç”¨åŸŸ

**finalçš„ä¸åŒä½œç”¨åŸŸ**ï¼š

```java
public class FinalExample {
    // 1. finalç±»ï¼šä¸èƒ½è¢«ç»§æ‰¿
    public final class ImmutableClass {
        private final int value;
        
        public ImmutableClass(int value) {
            this.value = value;
        }
        
        public int getValue() {
            return value;
        }
    }
    
    // 2. finalæ–¹æ³•ï¼šä¸èƒ½è¢«å­ç±»é‡å†™
    public class BaseClass {
        public final void finalMethod() {
            System.out.println("This method cannot be overridden");
        }
    }
    
    // 3. finalå˜é‡ï¼šåŸºæœ¬ç±»å‹å€¼ä¸å¯å˜ï¼Œå¼•ç”¨ç±»å‹å¼•ç”¨ä¸å¯å˜
    public void finalVariables() {
        // finalåŸºæœ¬ç±»å‹å˜é‡
        final int immutableInt = 10;
        // immutableInt = 20; // ç¼–è¯‘é”™è¯¯
        
        // finalå¼•ç”¨ç±»å‹å˜é‡
        final List<String> immutableList = new ArrayList<>();
        immutableList.add("item1"); // å¯ä»¥ä¿®æ”¹å†…å®¹
        // immutableList = new ArrayList<>(); // ç¼–è¯‘é”™è¯¯ï¼Œå¼•ç”¨ä¸å¯å˜
        
        // finalæ–¹æ³•å‚æ•°
        final String finalParam = "cannot change";
        processFinalParam(finalParam);
    }
    
    private void processFinalParam(final String param) {
        // param = "new value"; // ç¼–è¯‘é”™è¯¯
        System.out.println(param);
    }
    
    // 4. finalå­—æ®µï¼šå¿…é¡»åœ¨æ„é€ å‡½æ•°ç»“æŸå‰åˆå§‹åŒ–
    public class FinalFieldClass {
        private final String name;
        private final int count;
        
        public FinalFieldClass(String name, int count) {
            this.name = name; // å¿…é¡»åˆå§‹åŒ–
            this.count = count; // å¿…é¡»åˆå§‹åŒ–
        }
    }
}
```

### 5. RPCè°ƒç”¨åŸç†

**RPCè°ƒç”¨æµç¨‹**ï¼š
```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant Stub as å®¢æˆ·ç«¯å­˜æ ¹
    participant Network as ç½‘ç»œä¼ è¾“
    participant Skeleton as æœåŠ¡ç«¯éª¨æ¶
    participant Server as æœåŠ¡å®ç°

    Client->>Stub: è°ƒç”¨æœ¬åœ°æ–¹æ³•
    Stub->>Stub: åºåˆ—åŒ–å‚æ•°
    Stub->>Network: å‘é€è¯·æ±‚
    Network->>Skeleton: æ¥æ”¶è¯·æ±‚
    Skeleton->>Skeleton: ååºåˆ—åŒ–å‚æ•°
    Skeleton->>Server: è°ƒç”¨å®é™…æ–¹æ³•
    Server-->>Skeleton: è¿”å›ç»“æœ
    Skeleton->>Skeleton: åºåˆ—åŒ–ç»“æœ
    Skeleton->>Network: å‘é€å“åº”
    Network->>Stub: æ¥æ”¶å“åº”
    Stub->>Stub: ååºåˆ—åŒ–ç»“æœ
    Stub-->>Client: è¿”å›ç»“æœ
```

**Java RPCå®ç°ç¤ºä¾‹**ï¼š
```java
// 1. å®šä¹‰æœåŠ¡æ¥å£
public interface UserService {
    User getUserById(int id);
    List<User> getUsersByDepartment(String department);
}

// 2. å®¢æˆ·ç«¯ä»£ç†
public class UserServiceProxy implements UserService {
    private final String serviceUrl;
    
    public UserServiceProxy(String serviceUrl) {
        this.serviceUrl = serviceUrl;
    }
    
    @Override
    public User getUserById(int id) {
        // åºåˆ—åŒ–å‚æ•°
        String requestData = serializeRequest("getUserById", new Object[]{id});
        
        // å‘é€ç½‘ç»œè¯·æ±‚
        String response = sendRequest(serviceUrl, requestData);
        
        // ååºåˆ—åŒ–ç»“æœ
        return deserializeResponse(response, User.class);
    }
    
    private String serializeRequest(String method, Object[] params) {
        // ä½¿ç”¨JSONåºåˆ—åŒ–
        Map<String, Object> request = new HashMap<>();
        request.put("method", method);
        request.put("params", params);
        return new Gson().toJson(request);
    }
    
    private String sendRequest(String url, String data) {
        // ä½¿ç”¨HTTPå®¢æˆ·ç«¯å‘é€è¯·æ±‚
        // å®ç°ç•¥...
        return null;
    }
    
    private <T> T deserializeResponse(String response, Class<T> clazz) {
        return new Gson().fromJson(response, clazz);
    }
}

// 3. æœåŠ¡ç«¯å®ç°
@WebService
public class UserServiceImpl implements UserService {
    
    @Override
    public User getUserById(int id) {
        // å®é™…æ•°æ®åº“æŸ¥è¯¢
        return userRepository.findById(id);
    }
    
    @Override
    public List<User> getUsersByDepartment(String department) {
        return userRepository.findByDepartment(department);
    }
}
```

### 6. æ‰¾å‡ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ 

**ç®—æ³•å®ç°**ï¼š
```java
import java.util.*;

public class MostFrequentElement {
    
    /**
     * æ‰¾å‡ºæ•°ç»„ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ 
     * æ—¶é—´å¤æ‚åº¦: O(n)
     * ç©ºé—´å¤æ‚åº¦: O(n)
     */
    public static <T> T findMostFrequent(T[] array) {
        if (array == null || array.length == 0) {
            throw new IllegalArgumentException("Array cannot be null or empty");
        }
        
        Map<T, Integer> frequencyMap = new HashMap<>();
        T mostFrequent = array[0];
        int maxCount = 0;
        
        for (T element : array) {
            // æ›´æ–°é¢‘ç‡è®¡æ•°
            int count = frequencyMap.getOrDefault(element, 0) + 1;
            frequencyMap.put(element, count);
            
            // æ›´æ–°æœ€å¤§é¢‘ç‡å…ƒç´ 
            if (count > maxCount) {
                maxCount = count;
                mostFrequent = element;
            }
        }
        
        return mostFrequent;
    }
    
    /**
     * ä½¿ç”¨Stream APIçš„ç‰ˆæœ¬
     */
    public static <T> T findMostFrequentStream(T[] array) {
        return Arrays.stream(array)
                .collect(Collectors.groupingBy(
                    Function.identity(), 
                    Collectors.counting()
                ))
                .entrySet()
                .stream()
                .max(Map.Entry.comparingByValue())
                .map(Map.Entry::getKey)
                .orElseThrow(() -> new IllegalArgumentException("Array is empty"));
    }
    
    /**
     * å¤„ç†å¤šä¸ªå…ƒç´ å‡ºç°æ¬¡æ•°ç›¸åŒçš„æƒ…å†µ
     */
    public static <T> List<T> findMostFrequentElements(T[] array) {
        Map<T, Integer> frequencyMap = new HashMap<>();
        int maxCount = 0;
        
        // ç¬¬ä¸€æ¬¡éå†ï¼šç»Ÿè®¡é¢‘ç‡å¹¶æ‰¾åˆ°æœ€å¤§æ¬¡æ•°
        for (T element : array) {
            int count = frequencyMap.getOrDefault(element, 0) + 1;
            frequencyMap.put(element, count);
            maxCount = Math.max(maxCount, count);
        }
        
        // ç¬¬äºŒæ¬¡éå†ï¼šæ”¶é›†æ‰€æœ‰å‡ºç°maxCountæ¬¡çš„å…ƒç´ 
        List<T> result = new ArrayList<>();
        for (Map.Entry<T, Integer> entry : frequencyMap.entrySet()) {
            if (entry.getValue() == maxCount) {
                result.add(entry.getKey());
            }
        }
        
        return result;
    }
    
    // æµ‹è¯•ä»£ç 
    public static void main(String[] args) {
        Integer[] numbers = {1, 2, 3, 2, 4, 2, 5, 2, 3, 3};
        String[] words = {"apple", "banana", "apple", "orange", "banana", "apple"};
        
        System.out.println("Most frequent number: " + findMostFrequent(numbers));
        System.out.println("Most frequent word: " + findMostFrequent(words));
        
        System.out.println("All most frequent numbers: " + findMostFrequentElements(numbers));
        System.out.println("All most frequent words: " + findMostFrequentElements(words));
    }
}
```

## ä¸‰é¢é—®é¢˜è§£ç­”

### 1. JVMå†…å­˜åˆ†åŒºè®¾è®¡

**EdenåŒºè®¾è®¡åŸç†**ï¼š
```mermaid
graph TD
    A[JVMå†…å­˜åˆ†åŒºè®¾è®¡] --> B[æ–°ç”Ÿä»£ Young Generation]
    A --> C[è€å¹´ä»£ Old Generation]
    
    B --> B1[EdenåŒº]
    B --> B2[SurvivoråŒº S0]
    B --> B3[SurvivoråŒº S1]
    
    B1 --> B1_1[æ–°å¯¹è±¡åˆ†é…]
    B1 --> B1_2[å¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«æ­»äº¡]
    
    B2 --> B2_1[å­˜æ”¾ç¬¬ä¸€æ¬¡GCåå­˜æ´»å¯¹è±¡]
    B3 --> B3_1[å­˜æ”¾ç¬¬äºŒæ¬¡GCåå­˜æ´»å¯¹è±¡]
    
    C --> C1[é•¿æœŸå­˜æ´»å¯¹è±¡]
    C --> C2[å¤§å¯¹è±¡ç›´æ¥è¿›å…¥]
    
    D[è®¾è®¡åŸå› ] --> D1[å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç¬¦åˆäºŒå…«å®šå¾‹]
    D --> D2[å‡å°‘å†…å­˜ç¢ç‰‡]
    D --> D3[æé«˜GCæ•ˆç‡]
    
    E[æ¯”ä¾‹æƒè¡¡] --> E1[é»˜è®¤æ¯”ä¾‹: Eden:S0:S1 = 8:1:1]
    E --> E2[æ ¹æ®åº”ç”¨ç‰¹æ€§è°ƒæ•´]
    E --> E3[ç›‘æ§GCæ—¥å¿—ä¼˜åŒ–]
```

**ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨S0/S1**ï¼š
1. **å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç‰¹æ€§**ï¼šå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«æ­»äº¡ï¼ŒEdenåŒºé›†ä¸­åˆ†é…æé«˜æ•ˆç‡
2. **å†…å­˜åˆ©ç”¨ç‡**ï¼šEdenåŒºè¾ƒå¤§ï¼Œå‡å°‘é¢‘ç¹GC
3. **å¤åˆ¶ç®—æ³•ä¼˜åŒ–**ï¼šEdenâ†’Survivorçš„å¤åˆ¶æ¯”Survivorä¹‹é—´çš„å¤åˆ¶æ›´é«˜æ•ˆ
4. **ç©ºé—´å±€éƒ¨æ€§**ï¼šæ–°å¯¹è±¡åœ¨ä¸€èµ·åˆ†é…ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡

### 2. MySQL MVCCæœºåˆ¶

**MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶**ï¼š

```java
// MVCCå®ç°åŸç†æ¨¡æ‹Ÿ
public class MVCCSimulation {
    // è¡Œè®°å½•ç»“æ„
    static class RowRecord {
        int id;
        String data;
        int createVersion;  // åˆ›å»ºæ—¶çš„äº‹åŠ¡ç‰ˆæœ¬å·
        int deleteVersion;  // åˆ é™¤æ—¶çš„äº‹åŠ¡ç‰ˆæœ¬å·
        
        public RowRecord(int id, String data, int version) {
            this.id = id;
            this.data = data;
            this.createVersion = version;
            this.deleteVersion = 0; // 0è¡¨ç¤ºæœªåˆ é™¤
        }
        
        public boolean isVisible(int currentVersion) {
            // è®°å½•åœ¨å½“å‰äº‹åŠ¡å¼€å§‹æ—¶å·²ç»å­˜åœ¨ï¼Œä¸”æœªè¢«åˆ é™¤
            return createVersion <= currentVersion && 
                  (deleteVersion == 0 || deleteVersion > currentVersion);
        }
    }
    
    // äº‹åŠ¡ç®¡ç†å™¨
    static class Transaction {
        int version;
        boolean isReadOnly;
        
        public Transaction(int version, boolean isReadOnly) {
            this.version = version;
            this.isReadOnly = isReadOnly;
        }
        
        public String readData(RowRecord record) {
            if (record.isVisible(this.version)) {
                return record.data;
            }
            return null; // è®°å½•å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§
        }
        
        public void updateData(RowRecord record, String newData, int newVersion) {
            // æ ‡è®°æ—§è®°å½•ä¸ºåˆ é™¤
            record.deleteVersion = newVersion;
            // åˆ›å»ºæ–°ç‰ˆæœ¬è®°å½•ï¼ˆå®é™…å®ç°ä¸­ä¼šåˆ›å»ºæ–°è¡Œï¼‰
        }
    }
    
    // ReadViewå®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰
    static class ReadView {
        int lowLimitId;    // å½“å‰æ´»è·ƒäº‹åŠ¡çš„æœ€å°ID
        int upLimitId;     // ä¸‹ä¸€ä¸ªå°†è¦åˆ†é…çš„äº‹åŠ¡ID
        Set<Integer> activeTransactions; // æ´»è·ƒäº‹åŠ¡é›†åˆ
        
        public boolean isVisible(int trxId) {
            if (trxId < lowLimitId) {
                // äº‹åŠ¡åœ¨ReadViewåˆ›å»ºå‰å·²æäº¤
                return true;
            } else if (trxId >= upLimitId) {
                // äº‹åŠ¡åœ¨ReadViewåˆ›å»ºåå¼€å§‹
                return false;
            } else {
                // äº‹åŠ¡åœ¨æ´»è·ƒåˆ—è¡¨ä¸­ä¸å¯è§
                return !activeTransactions.contains(trxId);
            }
        }
    }
}
```

**MVCCæ ¸å¿ƒç‰¹æ€§**ï¼š
1. **éé˜»å¡è¯»**ï¼šè¯»æ“ä½œä¸ä¼šé˜»å¡å†™æ“ä½œ
2. **ç‰ˆæœ¬é“¾**ï¼šæ¯è¡Œæ•°æ®æœ‰å¤šä¸ªç‰ˆæœ¬
3. **ReadView**ï¼šäº‹åŠ¡å¯è§æ€§åˆ¤æ–­
4. **undo log**ï¼šå­˜å‚¨æ—§ç‰ˆæœ¬æ•°æ®

### 3. é“¾è¡¨éšæœºèŠ‚ç‚¹ç®—æ³•

**æ°´åº“æŠ½æ ·ç®—æ³•å®ç°**ï¼š

```java
import java.util.Random;

public class LinkedListRandomNode {
    
    static class ListNode {
        int val;
        ListNode next;
        ListNode(int x) { val = x; }
    }
    
    private ListNode head;
    private Random random;
    
    public LinkedListRandomNode(ListNode head) {
        this.head = head;
        this.random = new Random();
    }
    
    /**
     * æ°´åº“æŠ½æ ·ç®—æ³• - éšæœºè¿”å›ä¸€ä¸ªèŠ‚ç‚¹
     * æ—¶é—´å¤æ‚åº¦: O(n)
     * ç©ºé—´å¤æ‚åº¦: O(1)
     */
    public int getRandom() {
        ListNode current = head;
        int result = current.val;
        int count = 1;
        
        while (current != null) {
            // ä»¥1/countçš„æ¦‚ç‡é€‰æ‹©å½“å‰èŠ‚ç‚¹
            if (random.nextInt(count) == 0) {
                result = current.val;
            }
            count++;
            current = current.next;
        }
        
        return result;
    }
    
    /**
     * æ‰©å±•ï¼šéšæœºè¿”å›kä¸ªèŠ‚ç‚¹
     */
    public int[] getRandomK(int k) {
        if (head == null || k <= 0) {
            return new int[0];
        }
        
        int[] result = new int[k];
        ListNode current = head;
        
        // å‰kä¸ªèŠ‚ç‚¹å…ˆæ”¾å…¥ç»“æœ
        for (int i = 0; i < k && current != null; i++) {
            result[i] = current.val;
            current = current.next;
        }
        
        int count = k;
        Random random = new Random();
        
        // å¤„ç†å‰©ä½™èŠ‚ç‚¹
        while (current != null) {
            count++;
            // ä»¥k/countçš„æ¦‚ç‡æ›¿æ¢ç»“æœä¸­çš„æŸä¸ªå…ƒç´ 
            int randomIndex = random.nextInt(count);
            if (randomIndex < k) {
                result[randomIndex] = current.val;
            }
            current = current.next;
        }
        
        return result;
    }
    
    /**
     * å¦ä¸€ç§è§£æ³•ï¼šå…ˆè·å–é•¿åº¦å†éšæœºé€‰æ‹©
     */
    public int getRandomByLength() {
        int length = getLength();
        if (length == 0) {
            throw new IllegalStateException("List is empty");
        }
        
        int randomIndex = random.nextInt(length);
        ListNode current = head;
        
        for (int i = 0; i < randomIndex; i++) {
            current = current.next;
        }
        
        return current.val;
    }
    
    private int getLength() {
        int length = 0;
        ListNode current = head;
        while (current != null) {
            length++;
            current = current.next;
        }
        return length;
    }
    
    // æµ‹è¯•ä»£ç 
    public static void main(String[] args) {
        // åˆ›å»ºé“¾è¡¨: 1->2->3->4->5
        ListNode head = new ListNode(1);
        head.next = new ListNode(2);
        head.next.next = new ListNode(3);
        head.next.next.next = new ListNode(4);
        head.next.next.next.next = new ListNode(5);
        
        LinkedListRandomNode solution = new LinkedListRandomNode(head);
        
        // æµ‹è¯•å¤šæ¬¡è·å–éšæœºå€¼
        Map<Integer, Integer> frequency = new HashMap<>();
        for (int i = 0; i < 10000; i++) {
            int randomValue = solution.getRandom();
            frequency.put(randomValue, frequency.getOrDefault(randomValue, 0) + 1);
        }
        
        System.out.println("éšæœºå€¼åˆ†å¸ƒ: " + frequency);
    }
}
```

**ç®—æ³•åˆ†æ**ï¼š
1. **æ°´åº“æŠ½æ ·**ï¼šé€‚åˆä¸çŸ¥é“é“¾è¡¨é•¿åº¦çš„æƒ…å†µï¼Œä¸€æ¬¡éå†å®Œæˆ
2. **å…ˆè·å–é•¿åº¦**ï¼šéœ€è¦ä¸¤æ¬¡éå†ï¼Œä½†å®ç°ç®€å•
3. **ç©ºé—´å¤æ‚åº¦**ï¼šéƒ½æ˜¯O(1)ï¼Œä¸éœ€è¦é¢å¤–ç©ºé—´
4. **æ—¶é—´å¤æ‚åº¦**ï¼šæ°´åº“æŠ½æ ·O(n)ï¼Œå…ˆè·å–é•¿åº¦ä¹Ÿæ˜¯O(n)

è¿™äº›è§£ç­”æ¶µç›–äº†ç¾å›¢é¢è¯•ä¸­å¸¸è§çš„æ·±åº¦æŠ€æœ¯é—®é¢˜ï¼Œå±•ç¤ºäº†æ‰å®çš„è®¡ç®—æœºåŸºç¡€çŸ¥è¯†å’Œç®—æ³•èƒ½åŠ›ã€‚
