https://javaguide.cn/high-availability/high-availability-system-design.html


# 什么是高可用？可用性的判断标准是啥？
1. **高可用的定义**：高可用描述的是一个系统在大部分时间都是可用的，可以为我们提供服务的。高可用代表系统即使在发生硬件故障或者系统升级的时候，服务仍然是可用的。

2. **可用性的判断标准**：
    - **“几个9”评判法**：一般使用“多少个9”来评判系统的可用性，例如99.9999%的可用性意味着该系统在所有运行时间中，仅有0.0001%的时间是不可用的，属于极高可用的系统；部分可用性较差的系统，甚至可能达不到“1个9”的标准。
    - **请求失败率评判法**：也可以通过某功能的“失败请求次数”与“总请求次数”之比来衡量可用性。例如，对网站发起1000次请求，其中10次请求失败，则该系统的可用性为99%（计算方式：(1000-10)/1000×100% = 99%）。
  
3. # 哪些情况会导致系统不可用？
1. 黑客攻击：外部恶意攻击可能破坏系统正常运行，导致服务中断。
2. 硬件故障：如服务器硬件损坏、存储设备故障等，直接造成依赖该硬件的服务不可用。
3. 并发量/用户请求量激增：瞬时大量请求超出系统承载能力，可能导致整个服务宕机或部分功能无法响应。
4. 代码问题：代码中存在“坏味道”（如内存泄漏、循环依赖、逻辑漏洞等），可能引发程序异常挂掉，影响系统可用性。
5. 关键组件故障：网站架构中核心角色（如Nginx反向代理、数据库、缓存服务等）突然不可用，会导致整体服务链路中断。
6. 自然灾害或人为破坏：如地震、洪水等自然灾害损坏机房设施，或人为误操作破坏系统配置/数据，均会导致系统不可用。
7. 其他未列明的突发情况：如网络中断、第三方依赖服务故障等，也可能间接导致系统不可用。


# 有哪些提高系统可用性的方法？
## 1. 注重代码质量，测试严格把关
- **核心意义**：代码质量是保障系统可用性的源头，内存泄漏、循环依赖等代码问题会直接损害系统稳定性，需优先从源头把控。
- **具体措施**：
  - 推行CodeReview（代码审查），即使每天多花费1小时左右，也能有效发现代码隐患。
  - 使用代码质量优化工具：
    - Sonarqube：用于持续检测代码质量，识别漏洞、异味等问题。
    - Alibaba Arthas：Java诊断工具，可排查线上代码运行问题。
    - 阿里巴巴Java代码规范（Alibaba Java Code Guidelines）：规范代码编写标准。
    - IDEA自带代码分析工具：实时检测代码语法、逻辑问题。

## 2. 使用集群，减少单点故障
- **原理**：通过多实例组成集群，避免单一节点故障导致服务中断，当某一节点下线时，其他节点可快速接管服务。
- **示例**：Redis缓存高可用设计——单Redis实例故障会导致缓存服务中断，而Redis集群可在1秒内实现故障节点切换，保障缓存服务持续可用。

## 3. 限流
- **定义**：又称流量控制（flow control），通过监控应用的QPS（每秒查询率）、并发线程数等指标，当达到预设阈值时限制流量，避免瞬时高峰冲垮系统。
- **参考来源**：概念源自alibaba-Sentinel官方Wiki，是保障高可用的核心手段之一。

## 4. 超时和重试机制设置
- **超时设置**：用户请求超过指定时间未获响应时，主动抛出异常，避免请求堆积导致系统瘫痪。尤其在调用第三方服务时，必须设置超时，防止因外部服务延迟拖垮自身系统。
- **重试设置**：针对偶发失败的请求（如网络抖动导致的调用超时），可配置重试机制，但重试次数通常设为3次——过多重试会加重服务器压力，且部分场景（如支付请求）不适合重试。
- **注意事项**：许多RPC框架自带超时重试配置，需合理配置参数，避免因设置不当引发故障。

## 5. 熔断机制
- **原理**：系统自动收集依赖服务的资源使用情况、调用失败率等指标，当依赖服务性能恶化（如失败次数达阈值）时，立即“熔断”该依赖调用，避免故障扩散；同时可切换至备用服务，保障核心功能可用。
- **常用框架**：Netflix Hystrix、alibaba Sentinel，二者均提供成熟的流量控制与熔断降级能力。

## 6. 异步调用
- **优势**：无需等待任务完成即可返回结果，能减少用户请求响应时间、削峰填谷，同时降低系统耦合性，常见于秒杀等高并发场景。
- **业务配合要求**：需调整业务流程，例如用户提交订单后，不立即返回“订单成功”，而是通过消息队列异步处理订单，待订单真正完成（如出库）后，再通过邮件/短信通知用户。
- **实现方式**：程序内异步代码、消息队列（如RabbitMQ、Kafka）。

## 7. 使用缓存
- **作用**：缓存热点数据（如高频访问的商品信息、用户信息）至内存，减少数据库访问压力——若大量请求直接落到数据库，可能导致数据库宕机，而内存缓存响应速度远快于数据库，能显著提升系统可用性。

## 8. 其他补充措施
- 核心应用/服务优先使用更高配置的硬件，保障关键节点性能。
- 部署监控系统，实时监控资源使用情况（如CPU、内存、磁盘），并设置报警阈值，异常时及时通知运维人员。
- 重视数据备份与回滚机制，当系统出现故障时，可通过备份数据快速恢复服务。
- 采用灰度发布：将服务器集群分批次发布新版本，每批发布后观察稳定性，若发现问题仅需回滚已发布批次，降低全量发布风险。
- 定期检查/更换硬件（非云服务场景）：及时替换老化、性能不足的硬件，避免硬件故障引发系统不可用。
